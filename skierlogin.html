<html>
<head>
<title>Ski Patrol Login</title>
<!-- <link rel="stylesheet" href="styles.css"> -->
<link rel="stylesheet" href="src/master.css">
<link rel="stylesheet" href="styles.css">
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="bootstrap.min.css">
<link rel="stylesheet" href="https://use.typekit.net/viq2yvo.css">

</head>

<body>
  <div id="container">
    <a href="index.html">
      <div class="text-center my-5">
        <svg xmlns="http://www.w3.org/2000/svg" width="166.85" height="45.06" viewBox="0 0 166.85 45.06">
          <g id="Layer_2" data-name="Layer 2">
            <g id="Layer_1-2" data-name="Layer 1">
              <g>
                <path d="M19.81,27.44A6.89,6.89,0,0,1,17.32,33c-1.65,1.42-4.12,2.12-7.38,2.12a21.62,21.62,0,0,1-4.87-.49A40.51,40.51,0,0,1,.41,33.16V27a33.22,33.22,0,0,0,3.83,1.92,9.61,9.61,0,0,0,3.57.65c2.18,0,3.27-.6,3.27-1.79a1.49,1.49,0,0,0-.47-1.08A6.89,6.89,0,0,0,9,25.58c-.79-.39-1.83-.87-3.14-1.42A12.42,12.42,0,0,1,1.7,21.3,6.12,6.12,0,0,1,0,16.92a6.31,6.31,0,0,1,1.13-3.54,8,8,0,0,1,3.4-2.78A12.8,12.8,0,0,1,10,9.52c.51,0,1.17,0,2,.11a19.81,19.81,0,0,1,3,.57,16.19,16.19,0,0,1,3.48,1.31v6l-1.29-.78a13.89,13.89,0,0,0-1.4-.7,12.57,12.57,0,0,0-2.05-.69,9.26,9.26,0,0,0-2.41-.31,2.86,2.86,0,0,0-2.06.58,1.73,1.73,0,0,0-.56,1.17A1.55,1.55,0,0,0,9.33,18a9.86,9.86,0,0,0,2.6,1.29,23.94,23.94,0,0,1,4.65,2.29,7.4,7.4,0,0,1,2.49,2.59A7,7,0,0,1,19.81,27.44Z" fill="#231f20"/>
                <path d="M50.14,33.4a37.38,37.38,0,0,1-3.54,1.21,14.41,14.41,0,0,1-3.91.46,4.51,4.51,0,0,1-3-.76,4.24,4.24,0,0,1-1.21-1.85,13.12,13.12,0,0,1-3.13,1.87,11.44,11.44,0,0,1-4.51.74,8.83,8.83,0,0,1-4.35-.93,5.32,5.32,0,0,1-2.33-2.35,6.73,6.73,0,0,1-.67-2.92,6,6,0,0,1,1.15-3.77,8.49,8.49,0,0,1,3.1-2.44,39,39,0,0,1,5.14-2l2.75-.89L37,19.34a7.36,7.36,0,0,0,1-.44,4.74,4.74,0,0,0-.73-2.81q-.72-1-3.15-1a11.42,11.42,0,0,0-5.31,1.26,18.57,18.57,0,0,0-4.48,3.25V12.89A16.06,16.06,0,0,1,27.83,11a20.8,20.8,0,0,1,4-1.11A24.29,24.29,0,0,1,36,9.52c3.58,0,6.26.69,8.07,2.07a6.82,6.82,0,0,1,2.7,5.71v9.53a6.09,6.09,0,0,0,.25,2,.93.93,0,0,0,.94.66,5.41,5.41,0,0,0,2.23-.7ZM38,28.67V22.83a23.91,23.91,0,0,0-4.53,2.27A3.15,3.15,0,0,0,32,27.83a2.34,2.34,0,0,0,2.37,2.54,3.51,3.51,0,0,0,1.78-.5A14.89,14.89,0,0,0,38,28.67Z" fill="#231f20"/>
                <path d="M70.11,7.29a14.75,14.75,0,0,0-3.22-.46,2.72,2.72,0,0,0-2.19.92,3.91,3.91,0,0,0-.79,2.62v.87h4.41v5.92H63.91V34.64H55.16V17.16h-4V11.24h4v-.43a12.18,12.18,0,0,1,1-4.91,8.49,8.49,0,0,1,3.36-3.82A11.42,11.42,0,0,1,65.73.57,21.19,21.19,0,0,1,70.11,1Z" fill="#231f20"/>
                <path d="M97.22,24.41H79.84a6.08,6.08,0,0,0,2.49,3.68,7.5,7.5,0,0,0,4.51,1.43,23.44,23.44,0,0,0,9.75-2.47v5.41A27.13,27.13,0,0,1,92,34.26a25,25,0,0,1-7,.81,16.41,16.41,0,0,1-7.76-1.69,11.36,11.36,0,0,1-4.79-4.61,13.52,13.52,0,0,1-1.58-6.59,13.18,13.18,0,0,1,1.58-6.51,11,11,0,0,1,4.79-4.51A16.91,16.91,0,0,1,85,9.52a13.63,13.63,0,0,1,5.81,1.3,10.61,10.61,0,0,1,4.6,4.24,14.3,14.3,0,0,1,1.81,7.6ZM89,20.09a5.76,5.76,0,0,0-1.17-3.79,4.14,4.14,0,0,0-3.38-1.42,4.61,4.61,0,0,0-3.53,1.44,5.29,5.29,0,0,0-1.35,3.77Z" fill="#231f20"/>
                <path d="M120.81,27.44A6.89,6.89,0,0,1,118.32,33c-1.65,1.42-4.11,2.12-7.38,2.12a21.62,21.62,0,0,1-4.87-.49,41.12,41.12,0,0,1-4.66-1.42V27a33.22,33.22,0,0,0,3.83,1.92,9.61,9.61,0,0,0,3.57.65c2.18,0,3.27-.6,3.27-1.79a1.49,1.49,0,0,0-.47-1.08A6.89,6.89,0,0,0,110,25.58c-.78-.39-1.83-.87-3.14-1.42a12.42,12.42,0,0,1-4.12-2.86,6.12,6.12,0,0,1-1.7-4.38,6.31,6.31,0,0,1,1.13-3.54,8.1,8.1,0,0,1,3.4-2.78A12.8,12.8,0,0,1,111,9.52c.51,0,1.17,0,2,.11a19.81,19.81,0,0,1,3,.57,16.19,16.19,0,0,1,3.48,1.31v6l-1.29-.78a13.89,13.89,0,0,0-1.4-.7,12.57,12.57,0,0,0-2-.69,9.21,9.21,0,0,0-2.41-.31,2.86,2.86,0,0,0-2.06.58,1.73,1.73,0,0,0-.56,1.17,1.55,1.55,0,0,0,.58,1.13,9.86,9.86,0,0,0,2.6,1.29,23.94,23.94,0,0,1,4.65,2.29,7.31,7.31,0,0,1,2.49,2.59A7,7,0,0,1,120.81,27.44Z" fill="#231f20"/>
                <path d="M154.87,34.64H143.79l-9.48-11.71V34.64h-8.82V1h8.82V20.75L143,10h10.47l-9.65,11.51Z" fill="#231f20"/>
                <path d="M166.85,36.31H158.1V10h8.75ZM164.06,8.46h-3.35V0h3.35Zm-5.89-2.52V2.59h8.46V5.94ZM0,36.31H166.85a9,9,0,0,1-9.24,8.75H9.24A9,9,0,0,1,0,36.31Z" fill="#ed1c24"/>
              </g>
            </g>
          </g>
        </svg>
      </a>
      </div>
    
        <h1 class="text-center"> Sign Up</h1>
    <div class="row">
      <div class="form-group container my-2 col-sm-10" style="align-items:center;">
        <input type="text" id="username" name="username" placeholder="Username" class="form-control py-4" />
      </div>
    <div class="form-group container my-2 col-sm-10" style="align-items:center;">
        <input type="text" id="email" name="email" placeholder="E-mail" class="form-control py-4" />
      </div>
      <div class="form-group container my-2 col-sm-10 " style="align-items:center;">
        <input type="password" id="password" name="password" placeholder="Password" class="form-control py-4" />
      </div>
      <div class="form-group container my-2 col-sm-10">
        <input type="submit" id='signUp' name="signup_submit" value="Sign Up" class="btn btn-dark btn-lg text-light corners">
        <input type="submit" id='login' name="login" value="Login" class="btn btn-dark btn-lg text-light corners"/>
     </div>
    </div>
    </div>




</body>

<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";
  import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-database.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, browserSessionPersistence  } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-auth.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBcrulFBbF6HnawvRDlGFOhqTJJfRtbGTM",
  authDomain: "safeski-7c162.firebaseapp.com",
  databaseURL: "https://safeski-7c162-default-rtdb.firebaseio.com",
  projectId: "safeski-7c162",
  storageBucket: "safeski-7c162.appspot.com",
  messagingSenderId: "95077250865",
  appId: "1:95077250865:web:2c0cf9e05bde5716fca210"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const auth = getAuth();
  
signUp.addEventListener('click',(e) => {

  var email = document.getElementById('email').value;
  var password = document.getElementById('password').value;
  var username = document.getElementById('username').value;
  var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude,
          };

  createUserWithEmailAndPassword(auth, email, password)
    .then((userCredential) => {
     // Signed in
    
      set(ref(database, 'users/' + user.uid),{
          username: username,
          email: email,
          password: password,
      
      })
      
      alert('user created!');
      // ...


      console.log(pos);
    })
    .catch((error) => {
      const errorCode = error.code;
      const errorMessage = error.message;

      alert(errorMessage);
    // ..
    });

});

 login.addEventListener('click',(e)=>{
   var email = document.getElementById('email').value;
   var password = document.getElementById('password').value;

      signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        // Signed in
        const user = userCredential.user;

    
        const dt = new Date();
         update(ref(database, 'users/' + user.uid),{
          last_login: dt,
        })
        window.location.href = 'pwahome.html'
        //  alert('User loged in!');

        // ...
        // firebase.auth.Auth.Persistence.SESSION 
        // Above is the code to keep a persitant user
      
      })
      .catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message;

        alert(errorMessage);
  });

 });

const user = auth.currentUser;
onAuthStateChanged(auth, (user) => {
  if (user) {
    // User is signed in, see docs for a list of available properties
    // https://firebase.google.com/docs/reference/js/firebase.User
    const uid = user.uid;
    //bla bla bla
    // ...
  } else {
    // User is signed out
    // ...
    //bla bla bla
  }
});

// signOut.addEventListener('click',(e)=>{

//    signOut(auth).then(() => {
//      // Sign-out successful.
//      alert('user loged out');
//    }).catch((error) => {
//      // An error happened.
//      const errorCode = error.code;
//      const errorMessage = error.message;

//         alert(errorMessage);
//    });

// });

// const auth = getAuth();
setPersistence(auth, browserSessionPersistence)
  .then(() => {
    // Existing and future Auth states are now persisted in the current
    // session only. Closing the window would clear any existing state even
    // if a user forgets to sign out.
    // ...
    // New sign-in will be persisted with session persistence.
    return signInWithEmailAndPassword(auth, email, password);
  })
  .catch((error) => {
    // Handle Errors here.
    const errorCode = error.code;
    const errorMessage = error.message;
  });






</script>
</html>
